
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      --><title>code</title><meta name="generator" content="MATLAB 7.9"><meta name="date" content="2013-12-04"><meta name="m-file" content="eval_models"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h1>code</h1><pre class="codeinput">clear <span class="string">all</span>
close <span class="string">all</span>
clc

sys_order = 8;
bins = 25;
ts = 1/50;

models = [
<span class="string">'1161'</span>
<span class="string">'1169'</span>
<span class="string">'1265'</span>
<span class="string">'1266'</span>
<span class="string">'1358'</span>
<span class="string">'1359'</span>
<span class="string">'1365'</span>
<span class="string">'1562'</span>
<span class="string">'1563'</span>
<span class="string">'1564'</span>
<span class="string">'1565'</span>
<span class="string">'1656'</span>
<span class="string">'1661'</span>
<span class="string">'1662'</span>
<span class="string">'1663'</span>
<span class="string">'1665'</span>
<span class="string">'1760'</span>
<span class="string">'1761'</span>
<span class="string">'1762'</span>
<span class="string">'1763'</span>
<span class="string">'1860'</span>
<span class="string">'1861'</span>
<span class="string">'1862'</span>
<span class="string">'1863'</span>
<span class="string">'1859'</span>
<span class="string">'1960'</span>
<span class="string">'1962'</span>
<span class="string">'2058'</span>
<span class="string">'2059'</span>
<span class="string">'2060'</span>
<span class="string">'2159'</span>
<span class="string">'2160'</span>
<span class="string">'2257'</span>
<span class="string">'2258'</span>
<span class="string">'2259'</span>
<span class="string">'2357'</span>
<span class="string">'2358'</span>
<span class="string">'2359'</span>
<span class="string">'2360'</span>
<span class="string">'2361'</span>
<span class="string">'2457'</span>
<span class="string">'2458'</span>
<span class="string">'2555'</span>
<span class="string">'2556'</span>
<span class="string">'2557'</span>
<span class="string">'2558'</span>
<span class="string">'2656'</span>];


[Nm nm] = size(models);

<span class="keyword">for</span> i=1:Nm
    model_path = <span class="string">'/Users/akee/School/UCLA/01 thesis/uclathesis/data/models/20131017212836_63_39500/'</span>;
    model_file = strcat(<span class="string">'parsim_'</span>,num2str(models(i,:)), <span class="string">'_8.mat'</span>);
    load(strcat(model_path, model_file))

lam = eig(sys.a);
<span class="keyword">for</span> j = 1:sys_order
    re = real(lam(j));
    im = imag(lam(j));

    <span class="keyword">if</span> exist(<span class="string">'x'</span>,<span class="string">'var'</span>)
        x=[x; re];
    <span class="keyword">else</span>
        x = re;
    <span class="keyword">end</span>

    <span class="keyword">if</span> exist(<span class="string">'y'</span>,<span class="string">'var'</span>)
        y=[y; im];
    <span class="keyword">else</span>
        y = im;
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="keyword">end</span>


xi = linspace(-1,1,bins);
yi = linspace(-1,1,bins);

xr = interp1(xi,1:numel(xi),x,<span class="string">'nearest'</span>);
yr = interp1(yi,1:numel(yi),y,<span class="string">'nearest'</span>);

Z = accumarray([yr xr], 1, [bins bins]);



<span class="keyword">for</span> i=1:Nm
    model_path = <span class="string">'/Users/akee/School/UCLA/01 thesis/uclathesis/data/models/20131017212836_63_39500/'</span>;
    model_file = strcat(<span class="string">'parsim_'</span>,num2str(models(i,:)), <span class="string">'_8.mat'</span>);
    load(strcat(model_path, model_file))

    <span class="comment">% set initial condition</span>
    sys.ts = 1/50;


    <span class="comment">% Load verification data</span>
    load(<span class="string">'/Users/akee/School/UCLA/01 thesis/uclathesis/data/flight_test/20131017212626_31_38500/20131017212626.mat'</span>);
    u_ver = u;
    y_ver = y;
    clear <span class="string">u</span> <span class="string">y</span>

    <span class="comment">% build iddata object and estimate states</span>
    ver_dat = iddata(y_ver,u_ver,ts);
    x0est = findstates(sys,ver_dat);

    <span class="comment">%sim_opt = simOptions('InitialCondition',x0est);</span>

    y_sim = sim(sys,ver_dat.u, <span class="string">'InitialCondition'</span>,x0est);
    <span class="comment">%y_sim = sim(sys,ver_dat.u);</span>

    h = figure(1);
    subplot(7,1,1)
    plot(y_ver(:,1), <span class="string">'b--'</span>)
    hold <span class="string">on</span>
    plot(y_sim(:,1), <span class="string">'g-'</span>)
    plot_title = strcat(num2str(models(i,:)), <span class="string">'-IC'</span>);
    title(plot_title)

    subplot(7,1,2)
    plot(y_ver(:,2), <span class="string">'b--'</span>)
    hold <span class="string">on</span>
    plot(y_sim(:,2), <span class="string">'g-'</span>)

    subplot(7,1,3)
    plot(y_ver(:,3), <span class="string">'b--'</span>)
    hold <span class="string">on</span>
    plot(y_sim(:,3), <span class="string">'g-'</span>)

    subplot(7,1,4)
    plot(y_ver(:,4), <span class="string">'b--'</span>)
    hold <span class="string">on</span>
    plot(y_sim(:,4), <span class="string">'g-'</span>)

    subplot(7,1,5)
    plot(y_ver(:,5), <span class="string">'b--'</span>)
    hold <span class="string">on</span>
    plot(y_sim(:,5), <span class="string">'g-'</span>)

    subplot(7,1,6)
    plot(y_ver(:,6), <span class="string">'b--'</span>)
    hold <span class="string">on</span>
    plot(y_sim(:,6), <span class="string">'g-'</span>)

    subplot(7,1,7)
    imagesc(xi, yi, Z)
    colormap(flipud(gray))
    hold <span class="string">on</span>
    axis([-1.1 1.1 -1.1 1.1])
    axis <span class="string">square</span>
    plot([0 0],[-1.1 1.1], <span class="string">'k-'</span>)
    plot([-1.1 1.1],[0 0], <span class="string">'k-'</span>)
    t = 0:0.001:2*pi;
    plot(sin(t),cos(t), <span class="string">'k:'</span>)
    plot(eig(sys.a), <span class="string">'r+'</span>)
    Xlabel = xlabel(<span class="string">'Real'</span>);
    Ylabel = ylabel(<span class="string">'Imaginary'</span>);

    fig_dir = <span class="string">'/Users/akee/School/UCLA/01 thesis/uclathesis/fig/model_eval/'</span>;
    fig_name = strcat(models(i,:),<span class="string">'_ic.eps'</span>);
    set(gcf,<span class="string">'PaperUnits'</span>,<span class="string">'inches'</span>,<span class="string">'PaperPosition'</span>,[0 0 6.5 8])
    out_file = strcat(fig_dir, fig_name);
    print(h, <span class="string">'-depsc2'</span>, out_file, <span class="string">'-r100'</span>)
    close(gcf);

<span class="keyword">end</span>
</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.9<br></p></div><!--
##### SOURCE BEGIN #####
%% code

clear all
close all
clc

sys_order = 8;
bins = 25;
ts = 1/50;

models = [
'1161'
'1169'
'1265'
'1266'
'1358'
'1359'
'1365'
'1562'
'1563'
'1564'
'1565'
'1656'
'1661'
'1662'
'1663'
'1665'
'1760'
'1761'
'1762'
'1763'
'1860'
'1861'
'1862'
'1863'
'1859'
'1960'
'1962'
'2058'
'2059'
'2060'
'2159'
'2160'
'2257'
'2258'
'2259'
'2357'
'2358'
'2359'
'2360'
'2361'
'2457'
'2458'
'2555'
'2556'
'2557'
'2558'
'2656'];


[Nm nm] = size(models);

for i=1:Nm
    model_path = '/Users/akee/School/UCLA/01 thesis/uclathesis/data/models/20131017212836_63_39500/';
    model_file = strcat('parsim_',num2str(models(i,:)), '_8.mat');
    load(strcat(model_path, model_file))

lam = eig(sys.a);
for j = 1:sys_order
    re = real(lam(j));
    im = imag(lam(j));
    
    if exist('x','var')
        x=[x; re];
    else
        x = re;
    end
        
    if exist('y','var')
        y=[y; im];
    else
        y = im;
    end
end
end


xi = linspace(-1,1,bins);
yi = linspace(-1,1,bins);

xr = interp1(xi,1:numel(xi),x,'nearest');
yr = interp1(yi,1:numel(yi),y,'nearest');

Z = accumarray([yr xr], 1, [bins bins]);



for i=1:Nm
    model_path = '/Users/akee/School/UCLA/01 thesis/uclathesis/data/models/20131017212836_63_39500/';
    model_file = strcat('parsim_',num2str(models(i,:)), '_8.mat');
    load(strcat(model_path, model_file))

    % set initial condition
    sys.ts = 1/50;


    % Load verification data
    load('/Users/akee/School/UCLA/01 thesis/uclathesis/data/flight_test/20131017212626_31_38500/20131017212626.mat');
    u_ver = u;
    y_ver = y;
    clear u y

    % build iddata object and estimate states
    ver_dat = iddata(y_ver,u_ver,ts);
    x0est = findstates(sys,ver_dat);

    %sim_opt = simOptions('InitialCondition',x0est);

    y_sim = sim(sys,ver_dat.u, 'InitialCondition',x0est);
    %y_sim = sim(sys,ver_dat.u);

    h = figure(1);
    subplot(7,1,1)
    plot(y_ver(:,1), 'bREPLACE_WITH_DASH_DASH')
    hold on
    plot(y_sim(:,1), 'g-')
    plot_title = strcat(num2str(models(i,:)), '-IC');
    title(plot_title)

    subplot(7,1,2)
    plot(y_ver(:,2), 'bREPLACE_WITH_DASH_DASH')
    hold on
    plot(y_sim(:,2), 'g-')

    subplot(7,1,3)
    plot(y_ver(:,3), 'bREPLACE_WITH_DASH_DASH')
    hold on
    plot(y_sim(:,3), 'g-')

    subplot(7,1,4)
    plot(y_ver(:,4), 'bREPLACE_WITH_DASH_DASH')
    hold on
    plot(y_sim(:,4), 'g-')

    subplot(7,1,5)
    plot(y_ver(:,5), 'bREPLACE_WITH_DASH_DASH')
    hold on
    plot(y_sim(:,5), 'g-')

    subplot(7,1,6)
    plot(y_ver(:,6), 'bREPLACE_WITH_DASH_DASH')
    hold on
    plot(y_sim(:,6), 'g-')
    
    subplot(7,1,7)
    imagesc(xi, yi, Z)
    colormap(flipud(gray))
    hold on
    axis([-1.1 1.1 -1.1 1.1])
    axis square
    plot([0 0],[-1.1 1.1], 'k-')
    plot([-1.1 1.1],[0 0], 'k-')
    t = 0:0.001:2*pi;
    plot(sin(t),cos(t), 'k:')
    plot(eig(sys.a), 'r+')
    Xlabel = xlabel('Real');
    Ylabel = ylabel('Imaginary');
    
    fig_dir = '/Users/akee/School/UCLA/01 thesis/uclathesis/fig/model_eval/';
    fig_name = strcat(models(i,:),'_ic.eps');
    set(gcf,'PaperUnits','inches','PaperPosition',[0 0 6.5 8])
    out_file = strcat(fig_dir, fig_name);
    print(h, '-depsc2', out_file, '-r100')
    close(gcf);

end
##### SOURCE END #####
--></body></html>